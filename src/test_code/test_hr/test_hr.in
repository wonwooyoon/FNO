SIMULATION
  SIMULATION_TYPE SUBSURFACE
  
  PROCESS_MODELS
    SUBSURFACE_FLOW flow
      MODE RICHARDS
    /
    SUBSURFACE_TRANSPORT transport
      MODE GIRT
    /
  /

  CHECKPOINT 
    FORMAT HDF5
    PERIODIC TIME 100 yr
  /

END

SUBSURFACE

REFERENCE_TEMPERATURE 35
NUMERICAL_METHODS flow
  NEWTON_SOLVER
    ITOL_UPDATE 1.0d0
    NO_PRINT_CONVERGENCE
  /
  TIMESTEPPER
    INITIAL_TIMESTEP_SIZE 1.d-5 yr
    MAXIMUM_TIMESTEP_SIZE 1.d0 yr
    MAXIMUM_NUMBER_OF_TIMESTEPS 100000000
  /
/

NUMERICAL_METHODS transport
  NEWTON_SOLVER
    SNES_TYPE NTRDC
    STOL 1e-50
    ATOL 1e-13
    RTOL 1e-7
    MAXIMUM_NUMBER_OF_ITERATIONS 25
    NO_PRINT_CONVERGENCE
  /
  TIMESTEPPER
    INITIAL_TIMESTEP_SIZE 1.d-5 yr
    MAXIMUM_TIMESTEP_SIZE 1.d-2 yr
    MAXIMUM_NUMBER_OF_TIMESTEPS 100000000
  /
/

CHEMISTRY

  ACTIVITY_COEFFICIENTS LAG TIMESTEP

  PRIMARY_SPECIES
    H+
    Ca++
    Na+
    K+
    Mg++
    CO3--
    Cl-
    UO2++
    O2(aq)
    H4(SiO4)
    Fe++
    Al+++
    SO4--
  /
  SECONDARY_SPECIES
    OH-
    CH4
    Al(OH)4-
    Al(OH)3
    NaAl(OH)4
    Al(OH)2+
    HCO3-
    CO2 
    Na(HCO3)
    Mg(HCO3)+
    CaCO3
    Na(CO3)-
    FeCO3
    Fe(OH)CO3
    Ca(SO4)
    Ca(HCO3)+
    MgCl+
    Fe+++
    FeCl+
    Fe(SO4)
    Fe(OH)+
    Fe(OH)2+
    Fe(OH)3
    Fe(CO3)2--
    H2(aq)
    Mg(SO4)
    Mg(CO3)
    U++++
    Ca2UO2(CO3)3
    CaUO2(CO3)3--
    UO2(CO3)3----
    MgUO2(CO3)3--
    Mg2UO2(CO3)3
    UO2(CO3)2--
    UO2(CO3)
    UO2(OH)+
    UO2(OH)2
    U(OH)4
    UO2+
    HS-
    H2S
    Fe(HS)+
    SO3--
    S2O3--
    Na(S2O3)-
    Mg(S2O3)
    Ca(S2O3)
    H(SO3)-
    H(SO4)-
  /
  
  PASSIVE_GAS_SPECIES
    O2(g)
  /
  
  MINERALS
    Smectite_MX80
    InertMineral
    Quartz
    Gypsum
    Pyrite
    Calcite
    Dolomite
    Siderite
    Clinochlore
    UO2:2H2O(am)
  /

  ! Kinetics data from Palandri and Kharaka (2004) and Marty et al. (2015)
    
    MINERAL_KINETICS
    
    Smectite_MX80
      RATE_CONSTANT		0.0 mol/m^2-sec
    /

    InertMineral
      RATE_CONSTANT   0.0 mol/m^2-sec
    /
    
    Quartz
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        RATE_CONSTANT		  -13.99
	      ACTIVATION_ENERGY	87.6d3
      /
    /
    
    Gypsum
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        RATE_CONSTANT 		-2.79d0
	      ACTIVATION_ENERGY 	0.00
      /
    /   
    
    Calcite
      RATE_CONSTANT 1e-9
    /
    
    Pyrite
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        DISSOLUTION_RATE_CONSTANT     -7.52
        PRECIPITATION_RATE_CONSTANT    0.00
        ACTIVATION_ENERGY 56.9d3
        PREFACTOR_SPECIES H+
          ALPHA           -0.5
        /
        PREFACTOR_SPECIES Fe+++
          ALPHA           0.5
        /
      /
      PREFACTOR
        DISSOLUTION_RATE_CONSTANT     -4.55
        PRECIPITATION_RATE_CONSTANT   0.00
        ACTIVATION_ENERGY 56.9d3
        PREFACTOR_SPECIES O2(aq)
          ALPHA           0.5
        /
      /
      PREFACTOR
        DISSOLUTION_RATE_CONSTANT     0.00
        PRECIPITATION_RATE_CONSTANT   -9.00
        PREFACTOR_SPECIES H+
          ALPHA 0.00
        /
      /
    /
        
    Dolomite
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        RATE_CONSTANT		-3.553
	      ACTIVATION_ENERGY	46d3
	      PREFACTOR_SPECIES	H+
	        ALPHA			0.61
	      /
      /
      PREFACTOR
        RATE_CONSTANT		-7.959
	      ACTIVATION_ENERGY	31d3
      /
    /
        
    Siderite
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        RATE_CONSTANT		-5.23
	      ACTIVATION_ENERGY	56.0d3
	      PREFACTOR_SPECIES	H+
	        ALPHA			0.6
	      /
      /
      PREFACTOR
        RATE_CONSTANT		-8.68
	      ACTIVATION_ENERGY	56.0d3
      /
    /

    Clinochlore
      SURFACE_AREA_FUNCTION VOLUME_FRACTION_RATIO
      SURFACE_AREA_VOL_FRAC_POWER 0.66667
      PREFACTOR
        RATE_CONSTANT    -11.11
        ACTIVATION_ENERGY    88.0d3
        PREFACTOR_SPECIES H+
          ALPHA     0.5
        /
      /
      PREFACTOR
        RATE_CONSTANT     -12.52
        ACTIVATION_ENERGY    88.0d3
      /
    /         
       
    UO2:2H2O(am)
      RATE_CONSTANT 1e-9
    / 
  /
    
  DATABASE ./PFLOTRAN_O2_ThermoChimie_v12a_T_modified.dat
  
  LOG_FORMULATION
  
  OUTPUT
    ALL
    PH
    PE
    KD
    TOTAL
    SECONDARY_SPECIES
    TOTAL_SORBED
    MOLARITY
  /
  
END

GRID
  TYPE UNSTRUCTURED ../../mesh/output_test_hr/mesh.h5
END

FLUID_PROPERTY
  DIFFUSION_COEFFICIENT 1.d-9 
END

MATERIAL_PROPERTY source
  ID 2
  POROSITY 0.01
  TORTUOSITY 1.0
  LONGITUDINAL_DISPERSIVITY 0.1
  PERMEABILITY
    PERM_ISO 1.d-20 ! unit: m^2
  /
  CHARACTERISTIC_CURVES default
END

MATERIAL_PROPERTY bentonite
  ID 1
  POROSITY 0.4181818181818182
  TORTUOSITY 1.0
  LONGITUDINAL_DISPERSIVITY 0.1
  PERMEABILITY
    PERM_ISO 1.d-19 ! unit: m^2
  /
  CHARACTERISTIC_CURVES default
END

CHARACTERISTIC_CURVES default
  DEFAULT
END

OUTPUT
  VELOCITY_AT_CENTER
  SNAPSHOT_FILE
    PERIODIC TIME 10 yr
    FORMAT HDF5
    VARIABLES
      POROSITY
      PERMEABILITY
      VOLUME
    /
  /
  OBSERVATION_FILE
    PERIODIC TIME 1 yr
    VARIABLES
      NO_FLOW_VARIABLES
      NO_ENERGY_VARIABLES
      POROSITY
      VOLUME
    /
  /
  MASS_BALANCE_FILE
    PERIODIC TIME 1 yr
  /
END

TIME
  FINAL_TIME 50 yr
END

REGION all
  COORDINATES
    -5.d0 -5.d0 -5.d0
    5.d0 5.d0 5.d0
  /
END

REGION source 
  FILE ../../mesh/output_test_hr/material_2.txt
END

REGION bentonite
  FILE ../../mesh/output_test_hr/material_1.txt
END

FLOW_CONDITION initial_pressure
  TYPE
    LIQUID_PRESSURE DIRICHLET
  /
  LIQUID_PRESSURE 501325.d0 ! unit: Pa
END

TRANSPORT_CONDITION BENTONITE_TC
  TYPE DIRICHLET_ZERO_GRADIENT
  CONSTRAINT_LIST
    0.d0 bentonite_conc
  /
END

TRANSPORT_CONDITION SOURCE_TC
  TYPE DIRICHLET_ZERO_GRADIENT
  CONSTRAINT_LIST
    0.d0 source_conc
  /
END

INITIAL_CONDITION BENTONITE
  FLOW_CONDITION initial_pressure
  TRANSPORT_CONDITION BENTONITE_TC
  REGION bentonite
END

INITIAL_CONDITION SOURCE
  FLOW_CONDITION initial_pressure
  TRANSPORT_CONDITION SOURCE_TC
  REGION source
END

! Constraints are pre-calculated by PHREEQC to achieve semi-equilibrium state  
CONSTRAINT bentonite_conc
  ACKNOWLEDGE_ZERO_SURFACE_AREA
  CONCENTRATIONS
    H+		6.83427		pH
    CO3--	0.001881264 	T
    Ca++ 	0.0294397	T
    Cl-		0.1392766		Z
    Fe++	0.00003310096	T 
    K+		0.0009260782	T
    Mg++	0.01145159	T
    Na+		0.09379946		T
    SO4--	0.01793532	T
    H4(SiO4)	0.0002337517	T
    Al+++	0.00000001109302			T
    UO2++	1e-16			T
    O2(aq)	-2.574846		PE
  /
  MINERALS
    Smectite_MX80 	0.1978883811653056	8.5 	m^2/g
    InertMineral		0.07972072727272728	0.0 	m^2/m^3
    Quartz		0.028392727272727274	0.05 	m^2/g
    Gypsum		0.004549818181818182	0.05 	m^2/g
    Pyrite		0.00010472727272727273	0.05 	m^2/g
    Calcite		0.0	1e2 	m^2/m^3
    Dolomite		0.0	1e2 	m^2/m^3
    Siderite		0.0	1e2 	m^2/m^3
    Clinochlore  0.0 1e2 m^2/m^3
    UO2:2H2O(am)		0.0	0.0 	m^2/m^3
  /
/	

CONSTRAINT source_conc
  ACKNOWLEDGE_ZERO_SURFACE_AREA
  CONCENTRATIONS
    H+		6.83427		pH
    CO3--	0.001881264 	T
    Ca++ 	0.0294397	T
    Cl-		0.1392766		Z
    Fe++	0.00003310096	T 
    K+		0.0009260782	T
    Mg++	0.01145159	T
    Na+		0.09379946		T
    SO4--	0.01793532	T
    H4(SiO4)	0.0002337517	T
    Al+++	0.00000001109302			T
    UO2++	1E-4 T
    O2(aq)	-2.574846		PE
  /
  MINERALS
    Smectite_MX80 	0.0	0.0 	m^2/m^3
    InertMineral 0.94 0.0 m^2/m^3
    Quartz		0.0	0.0 	m^2/m^3	
    Gypsum		0.0	0.0 	m^2/m^3
    Pyrite		0.0	0.0 	m^2/m^3
    Calcite		0.0	0.0 	m^2/m^3
    Dolomite		0.0	0.0 	m^2/m^3
    Siderite		0.0	0.0 	m^2/m^3
    Clinochlore  0.0	0.0 	m^2/m^3
    UO2:2H2O(am)		0.0 0.0 m^2/m^3
  /
/
  
STRATA
  FILE ../../mesh/output_test_hr/mesh.h5
END
